FROM directus/directus:11.6.1

# Install system dependencies (try curl, fallback to wget)
USER root
RUN if command -v apt-get >/dev/null; then \
        apt-get update && \
        apt-get install -y curl && \
        rm -rf /var/lib/apt/lists/*; \
    elif command -v apk >/dev/null; then \
        apk add --no-cache curl; \
    else \
        apt-get update && \
        apt-get install -y wget && \
        rm -rf /var/lib/apt/lists/*; \
    fi

# Download the AWS RDS CA certificate (use curl if available, else wget)
RUN mkdir -p /app/certs && \
    if command -v curl >/dev/null; then \
        curl -o /app/certs/rds-combined-ca-bundle.pem https://s3.amazonaws.com/rds-downloads/rds-combined-ca-bundle.pem; \
    else \
        wget -O /app/certs/rds-combined-ca-bundle.pem https://s3.amazonaws.com/rds-downloads/rds-combined-ca-bundle.pem; \
    fi && \
    chmod 644 /app/certs/rds-combined-ca-bundle.pem

# Switch to the non-root user
USER node

# Expose the Directus port
EXPOSE 8055

# Start Directus with the standard command
CMD ["npx", "directus", "start"]


draft

Sprint Goal and Milestone Overview
For the upcoming sprint, our sprint goal is to deliver a critical product requirement, advance non-production unit testing and deployment readiness for the CMS upgrade, and make measurable progress on our technical debt reduction by migrating secrets to AWS Secrets Manager for Python Lambda functions. This focused effort ensures we meet immediate product needs, enhance system stability, and align with our quarterly technical objectives.
Key Tickets and Their Purpose:
1.  Ticket 4085 (Product Requirement): This ticket is a high-priority product requirement that must be completed by the end of the sprint to meet stakeholder expectations and deliver essential functionality to users.
2.  Tickets 4138, 2813, 2138, and 2159 (CMS Upgrade): These tickets are critical for non-production unit testing and establishing a deployment plan for the CMS upgrade. By completing these, we ensure timely development and readiness for QA, laying a robust foundation for a successful upgrade.
3.  Tickets 3969 and 3970 (Technical Debt): These tickets focus on migrating all secrets to AWS Secrets Manager for Python Lambda functions, contributing to our quarterly technical debt reduction goal. This work enhances security and maintainability of our infrastructure.