Dockerfile 


FROM directus/directus:11.6.1

# Install system dependencies (try curl, fallback to wget)
USER root
RUN if command -v apt-get >/dev/null; then \
        apt-get update && \
        apt-get install -y curl && \
        rm -rf /var/lib/apt/lists/*; \
    elif command -v apk >/dev/null; then \
        apk add --no-cache curl; \
    else \
        apt-get update && \
        apt-get install -y wget && \
        rm -rf /var/lib/apt/lists/*; \
    fi

# Download the AWS RDS CA certificate (use curl if available, else wget)
RUN mkdir -p /app/certs && \
    if command -v curl >/dev/null; then \
        curl -o /app/certs/rds-combined-ca-bundle.pem https://s3.amazonaws.com/rds-downloads/rds-combined-ca-bundle.pem; \
    else \
        wget -O /app/certs/rds-combined-ca-bundle.pem https://s3.amazonaws.com/rds-downloads/rds-combined-ca-bundle.pem; \
    fi && \
    chmod 644 /app/certs/rds-combined-ca-bundle.pem

# Install Node.js dependencies (aws-sdk for S3 storage) as node user
USER node
RUN npm cache clean --force && \
    npm install aws-sdk@2.1469.0 --no-save --loglevel=verbose

# Expose the Directus port
EXPOSE 8055

# Start Directus with the standard command
CMD ["npx", "directus", "start"]

Env

# General Directus configuration
PUBLIC_URL="https://your-directus-instance.com"
SECRET="your-secure-key"

# Database configuration (Aurora MySQL)
DB_CLIENT="mysql"
DB_HOST="your-aurora-cluster-endpoint"
DB_PORT="3306"
DB_DATABASE="directus"
DB_USER="username"
DB_PASSWORD="password"
DB_SSL="true"
DB_SSL__CA="/app/certs/rds-combined-ca-bundle.pem"

# Email configuration (for password reset emails)
EMAIL_TRANSPORT="smtp"
EMAIL_SMTP_HOST="smtp.example.com"
EMAIL_SMTP_PORT="587"
EMAIL_SMTP_USER="user@example.com"
EMAIL_SMTP_PASSWORD="yourpassword"
EMAIL_FROM="no-reply@yourdomain.com"

# S3 storage configuration (for directus_files migration)
STORAGE_LOCATIONS="s3"
STORAGE_S3_DRIVER="s3"
STORAGE_S3_KEY="your-access-key"
STORAGE_S3_SECRET="your-secret-key"
STORAGE_S3_REGION="us-east-1"
STORAGE_S3_BUCKET="your-bucket"

# Performance and debugging
LOG_LEVEL="debug"
HASH_MEMORY_COST="65536"
HASH_TIME_COST="3"
HASH_PARALLELISM="1"